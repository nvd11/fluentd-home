<source>
    @type tail
    path /app/logs/springboot.log
    pos_file /app/logs/springboot.log.pos
    tag springboot.logs 
    format none
</source>

<match **>
  @type bigquery_insert
  
  <buffer>
    flush_interval 0.1  # flush as frequent as possible    
    flush_thread_count 16
  </buffer>
  
  auth_method compute_engine
 #  json_key /app/gcp-key/fluentd-ingress-jason-hsbc.json
  # private_key_passphrase notasecret # default

  project jason-hsbc
  dataset DSK8S
  auto_create_table true
  table springboot_log

  schema [
    {"name": "time", "type": "INTEGER"},
    {"name": "status", "type": "INTEGER"},
    {"name": "bytes", "type": "INTEGER"},
    {"name": "vhost", "type": "STRING"},
    {"name": "path", "type": "STRING"},
    {"name": "method", "type": "STRING"},
    {"name": "protocol", "type": "STRING"},
    {"name": "agent", "type": "STRING"},
    {"name": "referer", "type": "STRING"},
    {"name": "remote", "type": "RECORD", "fields": [
      {"name": "host", "type": "STRING"},
      {"name": "ip", "type": "STRING"},
      {"name": "user", "type": "STRING"}
    ]},
    {"name": "requesttime", "type": "FLOAT"},
    {"name": "bot_access", "type": "BOOLEAN"},
    {"name": "loginsession", "type": "BOOLEAN"}
  ]
</match>